CREATE TABLE Student (
    STUDENTID VARCHAR(50) PRIMARY KEY,
	SSN INT,
    FIRSTNAME VARCHAR(50),
    MIDDLENAME VARCHAR(50),
    LASTNAME VARCHAR(50),
    Enrolled INT,
    Citizenship INT
);
CREATE TABLE DEPARTMENT(
    DEPARTMENTNAME VARCHAR(200) PRIMARY KEY
);
CREATE TABLE Faculty (
	FACULTYNAME VARCHAR(255) PRIMARY KEY,
    TITLE VARCHAR(255),
    DEPARTMENT VARCHAR(255),
    FOREIGN KEY (DEPARTMENT) REFERENCES DEPARTMENT(DEPARTMENTNAME)
);
CREATE TABLE COURSE (
    COURSEID VARCHAR(20) PRIMARY KEY,
    COURSENAME VARCHAR(20),
    UNIT INT,
    GRADE STATUS VARCHAR(100),
    PREREQUISITES VARCHAR(100),
    GENERALTOPIC VARCHAR(100),
    INSTRUCTORCONSENT BOOLEAN,
    ISREQUIREDLABWORK BOOLEAN,
    ISLOWER BOOLEAN,
    DEPARTMENT VARCHAR(20),
    FOREIGN KEY (DEPARTMENT) REFERENCES DEPARTMENT(DEPARTMENTNAME)
);
CREATE TABLE Class (
    COURSEID VARCHAR(20),
    COURSETITLE VARCHAR(255),
    QUARTER VARCHAR(255),
    YEAR INT,
    PRIMARY KEY (COURSEID, QUARTER, YEAR),
    FOREIGN KEY (COURSEID) REFERENCES Course(COURSEID)
);

CREATE TABLE SECTION(
    SECTIONID VARCHAR(20),
    COURSEID VARCHAR(20),
    QUARTER VARCHAR(255),
    YEAR INT,
    PRIMARY KEY (SECTIONID, COURSEID, QUARTER, YEAR),
    FOREIGN KEY (COURSEID, QUARTER, YEAR) REFERENCES CLASS (COURSEID, QUARTER, YEAR)
)

CREATE TABLE COURSEENROLLMENT (
    STUDENTID VARCHAR(50),
    COURSEID VARCHAR(20),
    SECTIONID VARCHAR(20),
    unit INT,
    GRADEOPTION INT,
    PRIMARY KEY (STUDENTID,COURSEID,SECTIONID),
    FOREIGN KEY (STUDENTID) REFERENCES STUDENT(STUDENTID),
    FOREIGN KEY (COURSEID) REFERENCES CLASS(COURSEID)
    FOREIGN KEY (SECTIONID) REFERENCES SECTION(SECTIONID)
);

CREATE TABLE PASTCLASS (
    STUDENTID VARCHAR(50),
    COURSEID VARCHAR(20),
    SECTIONID VARCHAR(20),
    Quarter VARCHAR(255),
    Year INT,
    unit INT,
    GRADEOPTION INT,
    PRIMARY KEY (STUDENTID,COURSEID,SECTIONID,QUARTER,YEAR),
    FOREIGN KEY (STUDENTID,COURSEID,SECTIONID,QUARTER,YEAR),
    PRIMARY KEY (STUDENTID,COURSEID,SECTIONID),
    FOREIGN KEY (STUDENTID) REFERENCES STUDENT(STUDENTID),
    FOREIGN KEY (COURSEID, QUARTER, YEAR) REFERENCES CLASS(COURSEID, QUARTER, YEAR)
    FOREIGN KEY (SECTIONID) REFERENCES SECTION(SECTIONID)

);

CREATE TABLE Thesis (
    STUDENTID VARCHAR(255) PRIMARY KEY,
    ADVISORID VARCHAR(255),
    TOPIC VARCHAR(255),
    FOREIGN KEY (STUDENTID) REFERENCES STUDENT(STUDENTID)
    FOREIGN KEY (ADVISORID) REFERENCES FACULTY(FALCULTYID)
);


CREATE EXTENSION IF NOT EXISTS btree_gist;
CREATE TABLE Probation (
    STUDENTID VARCHAR(50),
    PROBATIONID VARCHAR(50),
	STARTDATE DATE,
    ENDDATE DATE,
    REASON VARCHAR(255),
    PRIMARY KEY (STUDENTID, PROBATIONID),
    FOREIGN KEY (STUDENTID) REFERENCES Student(STUDENTID),
	CONSTRAINT valid_period CHECK (STARTDATE < ENDDATE),
    CONSTRAINT unique_period UNIQUE (STUDENTID, STARTDATE, ENDDATE),
    CONSTRAINT no_overlap EXCLUDE USING GIST (
        STUDENTID WITH =,
        tsrange(STARTDATE, ENDDATE, '[)') WITH &&
    )
);

CREATE TABLE Review_Section (
    COURSEID INT,
    SECTIONID INT,
	STARTTIME TIMESTAMP,
    ENDTIME TIMESTAMP,
    BUILDING VARCHAR(255),
    PRIMARY KEY (COURSEID, SECTIONID, STARTTIME, ENDTIME),
    FOREIGN KEY (COURSEID) REFERENCES Class(COURSEID),
	CONSTRAINT valid_review_period CHECK (STARTTIME < ENDTIME),
    CONSTRAINT unique_review_period UNIQUE (STARTTIME, ENDTIME, BUILDING),
    CONSTRAINT no_review_overlap EXCLUDE USING GIST (
        SECTIONID WITH =,
        COURSEID WITH =,
        tsrange(STARTTIME, ENDTIME, '[)') WITH &&
    )
);

CREATE TABLE DEGREE_INFO (
	DEGREE_NAME VARCHAR(50),
    DEPARTMENT_NAME VARCHAR(50),
    CATEGORY VARCHAR(50),
	CLASS_LIST VARCHAR(255),
    UNIT INT,
    GRADE VARCHAR(10),
	PRIMARY KEY (DEGREE_NAME, DEPARTMENT_NAME, CATEGORY)
);