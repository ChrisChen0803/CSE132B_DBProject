CREATE TABLE Student (
    STUDENTID VARCHAR(50) PRIMARY KEY,
	SSN INT,
    FIRSTNAME VARCHAR(50),
    MIDDLENAME VARCHAR(50),
    LASTNAME VARCHAR(50),
    Enrolled INT,
    Citizenship INT
);

CREATE TABLE Faculty (
	FACULTYNAME VARCHAR(255) PRIMARY KEY,
    TITLE VARCHAR(255),
    DEPARTMENT VARCHAR(255)
);
CREATE TABLE COURSES (
    COURSEID INT PRIMARY KEY,
    COURSENAME VARCHAR(20),
    UNIT INT,
    GRADE STATUS INT,
    PREREQUISITES VARCHAR(100),
    GENERALTOPIC VARCHAR(100),
    INSTRUCTORCONSENT BOOLEAN,
    ISREQUIREDLABWORK BOOLEAN,
    ISLOWER BOOLEAN
);
CREATE TABLE COURSEENROLLMENT (
	ENROLLMENTID INT PRIMARY KEY,
    STUDENTID INT,
    COURSEID INT,
    SECTIONID INT,
    unit INT
);
CREATE TABLE PASTCLASSES (
	ENROLLMENTID INT,
    STUDENTID INT,
    COURSEID INT,
    SECTIONID INT,
    Quarter VARCHAR(255),
    Year INT,
    unit INT
);

CREATE TABLE Thesis (
	COMMITTEEID VARCHAR(255) PRIMARY KEY,
    STUDENTID VARCHAR(255),
    ADVISORID VARCHAR(255)
);


CREATE EXTENSION IF NOT EXISTS btree_gist;
CREATE TABLE Probation (
    STUDENTID VARCHAR(50),
    PROBATIONID VARCHAR(50),
	STARTDATE DATE,
    ENDDATE DATE,
    REASON VARCHAR(255),
    PRIMARY KEY (STUDENTID, PROBATIONID),
    FOREIGN KEY (STUDENTID) REFERENCES Student(STUDENTID),
	CONSTRAINT valid_period CHECK (STARTDATE < ENDDATE),
    CONSTRAINT unique_period UNIQUE (STUDENTID, STARTDATE, ENDDATE),
    CONSTRAINT no_overlap EXCLUDE USING GIST (
        STUDENTID WITH =,
        tsrange(STARTDATE, ENDDATE, '[)') WITH &&
    )
);

CREATE TABLE Class (
	COURSEID INT PRIMARY KEY,
    COURSETITLE VARCHAR(255),
    QUARTER VARCHAR(255),
    YEAR INT
);

CREATE TABLE Review_Section (
    COURSEID INT,
    SECTIONID INT,
	STARTTIME TIMESTAMP,
    ENDTIME TIMESTAMP,
    BUILDING VARCHAR(255),
    PRIMARY KEY (COURSEID, SECTIONID, STARTTIME, ENDTIME),
    FOREIGN KEY (COURSEID) REFERENCES Class(COURSEID),
	CONSTRAINT valid_review_period CHECK (STARTTIME < ENDTIME),
    CONSTRAINT unique_review_period UNIQUE (STARTTIME, ENDTIME, BUILDING),
    CONSTRAINT no_review_overlap EXCLUDE USING GIST (
        SECTIONID WITH =,
        COURSEID WITH =,
        tsrange(STARTTIME, ENDTIME, '[)') WITH &&
    )
);

CREATE TABLE DEGREE_INFO (
	DEGREE_NAME VARCHAR(50),
    DEPARTMENT_NAME VARCHAR(50),
    CATEGORY VARCHAR(50),
	CLASS_LIST VARCHAR(255),
    UNIT INT,
    GRADE VARCHAR(10),
	PRIMARY KEY (DEGREE_NAME, DEPARTMENT_NAME, CATEGORY)
);